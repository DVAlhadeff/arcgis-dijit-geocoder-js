<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=7, IE=9" />
        <!--The viewport meta tag is used to improve the presentation and behavior
        of the samples on iOS devices-->
        <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"
        />
        <title></title>
        <link rel="stylesheet" type="text/css" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.2/js/dojo/dijit/themes/soria/soria.css">
       <link rel="stylesheet" type="text/css" href="http://serverapi.arcgisonline.com/jsapi/arcgis/3.2/js/esri/css/esri.css" />
        <link rel="stylesheet" type="text/css" href="css/Geocoder.css">
        <style type="text/css">
            html, body, #map {
                height:100%;
                width:100%;
                margin:0;
                padding:0;
            }
            body {
                background-color:#FFF;
                overflow:hidden;
                font-family:"Trebuchet MS";
            }
            #search {
                display: block;
                position: absolute;
                z-index: 2;
                top: 20px;
                left: 100px;
            }
        </style>
        <script type="text/javascript">
            // host path regular expression
            var pathRegex = new RegExp(/\/[^\/]+$/);
            var locationPath = location.pathname.replace(pathRegex, '');

            // Dojo Config
            var dojoConfig = {
                //locale: "ar",
                parseOnLoad: true,
                packages: [{
                    name: "esriTemplate",
                    location: locationPath
                }]
            };
        </script>
        <script type="text/javascript" src="http://serverapi.arcgisonline.com/jsapi/arcgis/?v=3.2"></script>
        <script type="text/javascript" src="Geocoder.js"></script>
        <script type="text/javascript">
            dojo.require("dijit.dijit"); // optimize: load dijit layer
            dojo.require("dijit.layout.BorderContainer");
            dojo.require("dijit.layout.ContentPane");
            dojo.require("esri.map");
            dojo.require("esri.IdentityManager");
            dojo.require("esri.arcgis.utils");


            var map;
            var Geocoder;

            function init() {
                esri.config.defaults.io.proxyUrl = "/arcgisserver/apis/javascript/proxy/proxy.ashx";
                //This service is for development and testing purposes only. We recommend that you create your own geometry service for use within your applications.
                esri.config.defaults.geometryService = new esri.tasks.GeometryService("http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer");

                var urlObject = esri.urlToObject(document.location.href);
                var webmap = "31075fa2763f43bba0c2163814cc44aa";
                var bingMapsKey = "Enter your Bing Maps Key";
                if (urlObject.query) {
                    webmap = urlObject.query.webmap;
                    bingMapsKey = urlObject.query.bingMapsKey;
                }

                var mapDeferred = esri.arcgis.utils.createMap(webmap, "map", {
                    mapOptions: {
                        slider: true
                    },
                    bingMapsKey: bingMapsKey,
                    geometryServiceURL: "http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer"
                });
                mapDeferred.addCallback(function (response) {
                    map = response.map;

                    //resize the map when the browser resizes
                    dojo.connect(dijit.byId('map'), 'resize', map, map.resize);
                    dojo.connect(window, "onresize", resizeMap);

                    // Geocoder with all common options set. Only map is required.
                    Geocoder = new esri.dijit.Geocoder({
                        geocoder:[
                            {
                                url: 'http://tasks.arcgis.com/ArcGIS/rest/services/WorldLocator/GeocodeServer',
                                name: 'ArcGIS Tasks (old)',
                                placeholder: 'tasks.arcgis.com',
                                outFields:'*',
                                prefix:'',
                                postfix: '',
                                searchExtent: map.extent,
                            }
                        ],
						autocomplete: true,
						geocoderMenu: true,
                        esriGeocoder: {
                            placeholder: 'My Placeholder',
                            name: 'ArcGIS World Geocoder'
                        },
                        map: map
                    }, dojo.byId('search'));
					Geocoder.startup();

                });
                mapDeferred.addErrback(function (error) {
                    console.log("Map creation failed: ", dojo.toJson(error));
                });

            }

            function resizeMap() {
                map.resize();
                map.reposition();
            }

            //show map on load
            dojo.addOnLoad(init);
        </script>
    </head>

    <body class="soria">
        <div id="search"></div>
        <div id="map"></div>
    </body>

</html>